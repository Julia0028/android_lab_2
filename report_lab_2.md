# Лабораторная работа №2. Activity Lifecycle. Alternative resources.
### Цели
* Ознакомиться с жизненным циклом Activity
* Изучить основные возможности и свойства alternative resources

### Задачи

#### Задача 1. Activity

**Задание:** продемонстрируйте жизненный цикл Activity на любом нетривиальном примере.

**Решение:** 
Пример №1. Использование ADB для экстренного выключения приложения.
___
ADB (Android Debug Bridge)  - инструмент командной строки, который позволяет взаимодействовать с работающим эмулятором. Благодаря ADB была смоделирована ситуация, при которой ОС выключает приложение в фоновом режиме (например, если происходит нехватка RAM). Была выполнена команда kill, которая остановила процесс, как если бы он был остановлен ОС

*Рис. 1.1 Команда ADB*

![image_2_1](https://github.com/Julia0028/android_lab_2/blob/master/report_png/2_1.png)

Как можно увидеть ниже, после выполнения команды ОС "тихо" уничтожило процесс в фоновом режиме. Если пользователь переключится на другое приложение, а затем вернется к данному, оно перезапустится.

*Рис. 1.2 Жизненный цикл приложения до использования команды*

![image_1](https://github.com/Julia0028/android_lab_2/blob/master/report_png/1.png)

*Рис. 1.3 Перезапуск приложения после воздействия ADB*

![image_2](https://github.com/Julia0028/android_lab_2/blob/master/report_png/2.png)

![image_3](https://github.com/Julia0028/android_lab_2/blob/master/report_png/3.png)

Пример №2. Принятие входящего звонка
___

*Рис. 1.4 Жизненный цикл приложения во время принятия входящего звонка*

Как видно из скриншота, при принятии входящего звонка приложение переходит в состояние, при котором мы не можем с ним взаимодействовать, однако оно остается видимым  (вызывается метод onPaused()).

Пример №3. Взаимодействие с верхним меню
___

*Рис. 1.5 Жизненный цикл приложения при изменении настроек верхнего меню*

Как видно из скриншота, при отключении будильника процесс не изменяет своего состояния  (вызывается метод onResume()).

#### Задача 2. Alternative Resources

**Задание:** продемонстрируйте работу альтернативного ресурса (18 вариант) на каком-либо примере.

**Решение:** в данном варианте рассматривается квалификатор Avaliable width. 
Он задает минимальную доступную ширину экрана в единицах dp, при которой должен использоваться ресурс - определяется значением <N>. Это значение конфигурации изменяется при изменении ориентации с альбомной на книжную в соответствии с текущей фактической шириной. Таким образом, можно использовать только один квалификатор, чтобы указать минимальную ширину, необходимую для макета, вместо использования одновременно квалификаторов размера экрана и ориентации.
Система будет использовать тот макет, ширина которого ближе всего (не превышает) заданную ширину. 

В примерах ниже данный квалификатор позволяет грамотно распределить пространство экрана: 
При изменении ориентации с книжной на альбомую и увеличении ширины можно изменить расположение и размер кнопок, размер текста

*Рис. 2.1 Пример 1*

*Рис. 2.2 Пример 2*

#### Задача 3. Best-matching resource

**Задание:** для заданного набора альтернативных ресурсов, предоставляемых приложением, и заданной конфигурации устройства (18 вариант) объясните, какой ресурс будет выбран в конечном итоге. Ответ докажите.

Конфигурация устройства:
LOCALE_LANG: fr
LOCALE_REGION: rUS
SCREEN_SIZE: small
SCREEN_ASPECT: long
ROUND_SCREEN: round
ORIENTATION: port
UI_MODE: appliance
NIGHT_MODE: night
PIXEL_DENSITY: tvdpi
TOUCH: finger
PRIMARY_INPUT: qwerty
NAV_KEYS: dpad
PLATFORM_VER: v26

Конфигурация ресурсов:
(default)
large-12key-v25
en-large-tvdpi
car-notouch
notnight-v25
round-finger
fr-rCA-notlong-v27
notlong-xxhdpi-qwerty-wheel-v25
large-notlong-v25
land-watch-night-nonav
round-dpad-v27

**Решение:** 
1. Уберем те ресурсы, которые противоречат заданном конфигурации (fr):
(default)
large-12key-v25
~~en-large-tvdpi~~
car-notouch
notnight-v25
round-finger
fr-rCA-notlong-v27
notlong-xxhdpi-qwerty-wheel-v25
large-notlong-v25
land-watch-night-nonav
round-dpad-v27

2. Уберем те ресурсы, в которых не указано заданное требование (fr):
(default)
~~large-12key-v25~~
~~car-notouch~~
~~notnight-v25~~
~~round-finger~~
fr-rCA-notlong-v27
~~notlong-xxhdpi-qwerty-wheel-v25~~
~~large-notlong-v25~~
~~land-watch-night-nonav~~
~~round-dpad-v27~~

3. Уберем те ресурсы, которые противоречат заданном конфигурации (rUS):
(default)
~~fr-rCA-notlong-v27~~
**Ответ:** в конечном итоге будет выбран default

#### Задача 4. Сохранение состояние Activity.

**Задание:** Студент написал приложение: continuewatch. Это приложение должно считать, сколько секунд пользователь провел в этом приложении (когда оно отображается на экране; приложение не считает секунды, когда оно не отображается на экране; значение счетчика сохраняется при перезапуске приложения). Найдите ошибки в этом приложении и исправьте их.

**Решение:**

Ошибки:
* При запуске приложения отображается слово Hello World
* Таймер продолжает работать в фоновом режиме
* При изменении ориентации устройства значение счетчика сбрасывается

Для исправления 1 ошибки необходимо удалить атрибут text из макета;

Для исправления 2 ошибки был создан класс Seconds, в котором были реализованы функции подсчета секунд. Разрешение на подсчет осуществляется в методе onResume(), т.е. когда приложение переходит в состояние взаимодействия с пользователем. Запрет на подсчет находится в зеркальном методе - onPause(). Таким образом, счетчик не работает, когда находится в фоновом режиме;

При изменении ориентации значительно меняется конфигурация устройства, поэтому системе проще всего перезапустить Activity. Таким образом, необходимо переопределить метод onSaveInstanceState() для сохранения данных и добавить пару ключ-значение (счетчика) к объекту Bundle, который сохраняется на случай, если действие будет неожиданно уничтожено.

### Вывод

В данной лабораторной работе подробно изучен жизненный цикл Activity, рассмотрены методы обратного вызова, которые определяют поведение Activity при смене состояния. На практике было доказано, что их грамотное использование позволяет избежать: сбоев (когда пользователь переключается на другое приложение во время использования данного), потребления ценных системных ресурсов (когда приложение находится в фоновом режиме), потери данных при изменении ориентации устройства. Также были изучены возможности альтернативных ресурсов, которые позволяют подстраивать приложение под разные конфигурации устройства.

### Приложение

**MainAktivity.kt**

**res/layout/main_activity.xml**

**res/layout-w480dp/main_activity.xml**

**res/layout-w720dp/main_activity.xml**
